# 20-复习

## TCP/IP 模型 和 OSI 模型的异同 2015 2017

* 同
  * 都有分层
  * 都有应用层，实际内容不同
  * 都有相同的传输层和网络层
  * 假设采用分组交换（非电路交换）技术
  * 基于报文交换实现端到端通信
* 异
  * TCP/IP模型只有四层，而OSI模型有七层
  * TCP/IP模型将应用层、表示层和会话层合并为应用层
  * TCP/IP模型将数据链路层和物理层合并为网络接入层
  * TCP/IP模型是实际标准，OSI模型是理论标准

## 端口

| 端口   | 服务      |
| ---- | ------- |
| `20` | FTP数据传输 |
| `21` | FTP控制   |
| `23` | Telnet  |
| `53` | DNS     |
| `80` | HTTP    |

## TCP 建立连接 三次握手 2016 2017

1. 客户端 -> 服务端：SYN=1, seq=x
2. 服务端 -> 客户端：SYN=1, ACK=1, seq=y, ack=x+1
3. 客户端 -> 服务端：ACK=1, seq=x+1, ack=y+1

## TCP 释放连接 四次挥手 2016 2017

1. 客户端 -> 服务端：FIN=1, seq=x
2. 服务端 -> 客户端：ACK=1, seq=y, ack=x+1
3. 服务端 -> 客户端：FIN=1, ACK=1, seq=z, ack=x+1
4. 客户端 -> 服务端：ACK=1, seq=x+1, ack=z+1

* 前2次：关闭客户端到服务端的传输
* 在第2次握手后，服务端继续向客户端发送剩余数据
* 后2次：关闭服务端到客户端的传输
* 等待 2MSL
  * 保证服务端发送的最后一个 ACK 能够到达客户端
  * 确保能及时收到丢包重发的 FIN 包
  * 等待2MSL后若无重发的包则代表对方已经收到最后的ACK，连接可释放

## STP 端口裁判规则 小测7

1. 选择到根桥的路径开销最短的作为路径 （路径开销与带宽负相关，若有多段路程开销相加）
2. 若开销相同，发送者 Bridge ID最小的作为路径
3. 若发送者 Bridge ID 相同，发送者端口 ID 最小的作为路径

## Static vs Dynamic Routing 2016

| 对比项          | 静态路由            | 动态路由            |
| ------------ | --------------- | --------------- |
| 配置方式         | 手动配置            | 自动学习和更新路由信息     |
| 适用场景         | 小型网络            | 大型网络            |
| 资源占用（CPU/内存） | 少               | 多               |
| 带宽使用         | 不占用带宽           | 消耗带宽            |
| 故障恢复（收敛速度）   | 需要手动更改路由表，收敛速度慢 | 收敛速度快，能自动适应拓扑变化 |
| 安全性          | 风险小             | 风险大             |
| 灵活性          | 缺乏灵活性           | 高度灵活            |

## DV vs LS

| 对比项  | Distance Vector 距离矢量协议   | Link State 链路状态协议           |
| ---- | ------------------------ | --------------------------- |
| 视野   | 狭窄，无法获知具体拓扑              | 视野宽，知道整个拓扑结构                |
| 广播内容 | 路由表                      | 链路状态                        |
| 广播形式 | 被动，周期性广播                 | 主动，链路状态变化时广播                |
| 路由算法 | 通过跳数计算距离                 | 通过SPF（Dijkstra算法）计算最短路径     |
| 收敛速度 | 较慢，更新信息需要通过多个周期才能传播到整个网络 | 较快，一旦链路状态更新，所有路由器可以迅速重新计算路由 |
| 储存内容 | 路由表存储：存储所有路由器的路由表        | 链路状态数据库：存储所有路由器的链路状态信息      |

## 解决环路的方法 2016

* 设置最大值：当跳数超过一定值时，不再传递，视为不可达
* 路由毒化
  1. 当路由不可达时，将其距离设置为最大值
  2. Poision reverse：当其他路由器接收到路由毒化的消息时，将更新信息返回给发送者
  3. 最终所有路由器知道不可达
* 水平分割
  * 当网络不可达时，邻近的路由器不再接受目标为不可达网络的信息
  * 若为其他路由（绕开故障链路）则继续接受
* 计时器
  * 每条路由表信息都包含时效信息
  * 当不可达时启动计时器，超时后删除
  * 若在超时前收到更好的路由信息，则更新

## 请求时获取 MAC 的流程 2010 2018

| 步骤            | 源MAC      | 目的MAC               | 源IP  | 目的IP |
| ------------- | --------- | ------------------- | ---- | ---- |
| ARP 获取 MAC 地址 | 本机MAC     | `FF:FF:FF:FF:FF:FF` | 本机IP | 网关IP |
| 发送数据          | 本机MAC     | **网关MAC**           | 本机IP | 目的IP |
| 网关转发数据        | 网关另一接口MAC | 目的MAC               | 本机IP | 目的IP |
| 网关接收回复数据      | 网关MAC     | 网关另一接口MAC           | 目的IP | 本机IP |
| 网关发送回复数据      | 网关另一接口MAC | 本机MAC               | 目的IP | 本机IP |

## 输入网址到显示页面的流程 2020

1. 输入网址，查询DNS
   1. 若本地DNS有缓存则直接返回IP地址
   2. 若本地DNS没有缓存，则逐级向上查询
2. DNS 返回 IP 地址
3. 主机和服务器三次握手建立连接
4. 主机发送 HTTP 请求
5. 服务器返回 HTTP 响应
6. 主机接收响应，渲染页面
7. 四次挥手断开连接

## IEEE 802标准

| 标准      | 描述           |
| ------- | ------------ |
| 802.1q  | VLAN         |
| 802.2   | LLC          |
| 802.3   | MAC/Ethernet |
| 802.5   | Token Ring   |
| 802.11  | 无线局域网        |
| 802.11b | 2.4GHz 11M   |
| 802.11a | 5GHz 54M     |
| 802.11n | 100M         |

## 其他要点

* 私有IP地址：`10.0.0.0/8` `172.16.0.0/12` `192.168.0.0/16`
* 交换机只能打破冲突域，不能打破广播域
* OSPF 中的邻居需要有相同的计时器、网络号、子网掩码
* 新交换机默认有 VLAN 1
* 交换机无法学习广播地址：广播地址不会是源地址
* RIP v2 有类，是多播更新，发送子网掩码
* 底层为 TCP 的协议：HTTP、FTP、SMTP
* 底层为 UDP 的协议：RIP、DHCP、TFTP、SNMP
* 端口号的范围：`0-65535`
* 路由表更新题：
  * 有一个表中没有的直接写
  * 下一跳相同的，更新接收到的路由信息
  * 下一跳不相同，选距离短的更新
* 中继器、集线器不能分隔广播域，不能分隔冲突域
* 交换机、网桥不能分隔广播域，但可以分隔冲突域
* 路由器可以分割广播域，可以分割冲突域
* Routing protocol：RIP、OSPF、EIGRP
* Routed protocol：IP、IPX、AppleTalk
* OSPF hello `224.0.0.5`
* OSPF DR和BDR的组播地址 `224.0.0.6`
* RIP v2 `224.0.0.9`
* DHCP是应用层协议
* TCP/IP是无连接不可靠的
* 无效地址：广播地址（全1）、网络地址（全0）、私有地址
* 端口选举：开销、BID、PID
* 路由器配置文件存在 NVRAM 中
* 流控：数据链路层、传输层
* TCP是有连接的
* 跨VLAN访问先到自己网关网关，再到路由器，最后到对方网关
* B信道是64kbps，D信道是16kbps，BRI是144kbps
* CSMA/CD工作过程：先听后发，边听边发，冲突停止，延迟重发
* 100BASETX是屏蔽双绞线
* 100BASEFX是光纤
* Switch 所有的端口的 MAC 地址唯一，Router 所有的端口的 MAC 地址不同
